<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Editable Portfolio (Google Sheets Connected)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f3f4f6;
  margin:0;
  padding-top:70px;
}
nav{
  position:fixed;
  top:0;
  left:0;
  right:0;
  height:60px;
  background:#ffffff;
  box-shadow:0 2px 10px rgba(0,0,0,.1);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
  z-index:1000;
}
nav button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#2563eb;
  color:#fff;
}
#toolbar{
  position:fixed;
  top:70px;
  left:20px;
  background:#ffffff;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.15);
  padding:10px;
  display:none;
  z-index:999;
}
#toolbar select,#toolbar button,#toolbar input{
  margin:4px 0;
  width:100%;
  padding:6px;
}
main{
  max-width:900px;
  margin:auto;
  padding:20px;
}
section{
  margin-bottom:20px;
}
.card{
  background:#fff;
  border-radius:14px;
  padding:20px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
.editable{
  outline:none;
  margin-bottom:10px;
}
.controls{
  margin-top:10px;
}
.controls button{
  margin-right:8px;
}
.locked .editable{
  pointer-events:none;
}
</style>
</head>

<body class="locked">

<nav>
  <strong>My Portfolio</strong>
  <div>
    <button onclick="toggleLock()">ðŸ”’ Lock / Unlock</button>
    <button onclick="addSection()">âž• Section</button>
    <button onclick="saveToSheets()">ðŸ’¾ Save</button>
  </div>
</nav>

<div id="toolbar">
  <select onchange="format('formatBlock',this.value)">
    <option value="">Heading</option>
    <option value="p">Normal</option>
    <option value="h1">H1</option>
    <option value="h2">H2</option>
    <option value="h3">H3</option>
  </select>

  <button onclick="format('bold')">Bold</button>
  <button onclick="format('italic')">Italic</button>

  <select onchange="format(this.value)">
    <option value="">List</option>
    <option value="insertOrderedList">Ordered</option>
    <option value="insertUnorderedList">Unordered</option>
  </select>

  <input type="color" onchange="format('foreColor',this.value)">
  <button onclick="addBox()">âž• Text Box</button>
</div>

<main id="sections"></main>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbxILw13LgvTNwO8XU4qb2IOsQtCSD19UgBOy70P17JS0ooqid6JzcDWwRrkIMdOCyr3/exec";
let editEnabled = false;

/* ---------- LOCK ---------- */
function toggleLock(){
  editEnabled = !editEnabled;
  document.body.classList.toggle("locked", !editEnabled);
  document.getElementById("toolbar").style.display = editEnabled ? "block" : "none";
  document.querySelectorAll(".editable").forEach(e=>{
    e.contentEditable = editEnabled;
  });
}

/* ---------- FORMAT ---------- */
function format(cmd,value=null){
  document.execCommand(cmd,false,value);
}

/* ---------- SECTION ---------- */
function addSection(){
  const id = crypto.randomUUID();
  const sec = document.createElement("section");
  sec.dataset.id = id;
  sec.innerHTML = `
    <div class="card">
      <h2 class="editable">Section Title</h2>
      <p class="editable">Editable content...</p>
      <div class="controls">
        <button onclick="deleteSection(this)">ðŸ—‘ Delete</button>
      </div>
    </div>`;
  document.getElementById("sections").appendChild(sec);
  toggleEditable();
}

function deleteSection(btn){
  btn.closest("section").remove();
}

function addBox(){
  const sel = window.getSelection();
  if(!sel.rangeCount) return;
  const box = document.createElement("p");
  box.className = "editable";
  box.textContent = "New text box...";
  sel.getRangeAt(0).commonAncestorContainer.closest(".card")?.insertBefore(box, null);
  toggleEditable();
}

function toggleEditable(){
  document.querySelectorAll(".editable").forEach(e=>{
    e.contentEditable = editEnabled;
  });
}

/* ---------- SAVE ---------- */
async function saveToSheets(){
  if(!editEnabled) return;

  const sections = [...document.querySelectorAll("section")].map(sec=>{
    const edits = sec.querySelectorAll(".editable");
    const title = edits[0]?.innerHTML || "";
    let content = "";
    for(let i=1;i<edits.length;i++){
      content += edits[i].outerHTML;
    }
    return { id: sec.dataset.id, title, content };
  });

  try{
    const res = await fetch(SHEET_URL,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ sections })
    });
    const out = await res.json();
    if(out.status !== "success") throw out;
    alert("Saved successfully!");
  }catch(e){
    console.error(e);
    alert("Failed to save Google Sheets");
  }
}

/* ---------- LOAD ---------- */
async function loadFromSheets(){
  const res = await fetch(SHEET_URL);
  const data = await res.json();
  const wrap = document.getElementById("sections");
  wrap.innerHTML = "";

  data.forEach(sec=>{
    const s = document.createElement("section");
    s.dataset.id = sec.id;
    s.innerHTML = `
      <div class="card">
        <h2 class="editable">${sec.title}</h2>
        <div class="editable">${sec.content}</div>
        <div class="controls">
          <button onclick="deleteSection(this)">ðŸ—‘ Delete</button>
        </div>
      </div>`;
    wrap.appendChild(s);
  });
  toggleEditable();
}

loadFromSheets();
</script>

</body>
</html>
